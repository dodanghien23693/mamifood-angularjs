<!DOCTYPE html>
<!--[if IE 9]>         <html class="ie9 no-focus"> <![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-focus">
<!--<![endif]-->


<head>

    <script src="http://www.w3schools.com/lib/w3data.js"></script>

    <meta charset="utf-8">

    <title>OneUI - shared on themelock.com</title>

    <!-- Web fonts -->
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400italic,600,700%7COpen+Sans:300,400,400italic,600,700">

    <!-- Page JS Plugins CSS -->
    <script src="http://www.w3schools.com/lib/w3data.js"></script>

    <div w3-include-html="views/_includes/_head.html"></div>
    <div w3-include-html="views/_includes/_head-datatable.html"></div>

    <!-- You can include a specific file from css/themes/ folder to alter the default color theme of the template. eg: -->
    <!-- <link rel="stylesheet" id="css-theme" href="assets/css/themes/flat.min.css"> -->
    <!-- END Stylesheets -->
</head>
<body>
    <!-- Page Container -->
    <!--
        Available Classes:

        'sidebar-l'                  Left Sidebar and right Side Overlay
        'sidebar-r'                  Right Sidebar and left Side Overlay
        'sidebar-mini'               Mini hoverable Sidebar (> 991px)
        'sidebar-o'                  Visible Sidebar by default (> 991px)
        'sidebar-o-xs'               Visible Sidebar by default (< 992px)

        'side-overlay-hover'         Hoverable Side Overlay (> 991px)
        'side-overlay-o'             Visible Side Overlay by default (> 991px)

        'side-scroll'                Enables custom scrolling on Sidebar and Side Overlay instead of native scrolling (> 991px)

        'header-navbar-fixed'        Enables fixed header
    -->
    <div id="page-container" class="sidebar-l sidebar-o side-scroll header-navbar-fixed">
        <!-- Side Overlay-->
        <div w3-include-html="views/_includes/_side-overlay.html"></div>
        <!-- END Side Overlay -->
        <!-- Sidebar -->
        <div w3-include-html="views/_includes/_sidebar.html"></div>
        <!-- END Sidebar -->
        <!-- Header -->
        <div w3-include-html="views/_includes/_header.html"></div>
        <!-- END Header -->
        <!-- Main Container -->
        <main id="main-container">
            <!-- Page Header -->
            <div class="content bg-gray-lighter">
                <div class="row items-push">
                    <div class="col-sm-7">
                        <h1 class="page-heading">
                            DataTables <small>Tables transformed with dynamic features. Powered by DataTables.</small>
                        </h1>
                    </div>
                    <div class="col-sm-5 text-right hidden-xs">
                        <ol class="breadcrumb push-10-t">
                            <li>Tables</li>
                            <li><a class="link-effect" href="">DataTables</a></li>
                        </ol>
                    </div>
                </div>
            </div>
            <!-- END Page Header -->
            <!-- Page Content -->
            <div class="content">
                <!-- Dynamic Table Full -->
                <div class="block" id="danh-sach-sp">
                    <div class="block-header">
                        <h3 class="block-title">Danh sách sản phẩm</h3>
                    </div>

                    <div class="block-content">

                        <div class="filter-region filter">

                            <div class="form-group">
                                <label class="control-label col-sm-1">Kho</label>
                                <div class="col-sm-2">
                                    <select name="khoId" class="js-select2 form-control" data-placeholder="Chọn kho">
                                        <option value="-1">Tất cả</option><!-- Required for data-placeholder attribute to work with Chosen plugin -->
                                        <option value="1">kho 1</option>
                                        <option value="2">Kho 2</option>
                                        <option value="3">Kho 3</option>
                                        <option value="4">Kho 4</option>
                                        <option value="5">Kho 5</option>
                                        <option value="6">Kho 6</option>
                                        <option value="7">Kho 7</option>
                                    </select>
                                </div>
                            </div>


                            <div class="form-group">
                                <label class="control-label col-sm-2">Trạng thái</label>
                                <div class="col-sm-2">
                                    <select name="trangThai" class="js-select2 form-control" data-placeholder="Chọn trạng thái">
                                        <option value="-1">Tất cả</option><!-- Required for data-placeholder attribute to work with Chosen plugin -->
                                        <option value="Còn hàng">Còn hàng</option>
                                        <option value="Hết hàng">Hết hàng</option>
                                    </select>
                                </div>
                            </div>





                        </div>

                        <!-- DataTables init on table by adding .js-dataTable-full class, functionality initialized in js/pages/base_tables_datatables.js -->
                        <table class="table table-bordered table-striped js-dataTable-danh-sach-sp">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>Mã sản phẩm</th>
                                    <th>Tên sản phẩm</th>
                                    <th>Danh mục</th>
                                    <th>Hiển thị</th>
                                    <th width="18%">Trạng thái</th>
                                    <th>Số lượng</th>
                                    <th>Đơn vị</th>
                                    <th>Giá bán</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                        </table>

                        <div class="action-region">
                            <div class="form-group">
                                <div class="col-sm-2 align-left">
                                    <select class="form-control action-list">
                                        <option value="0">Tạo hóa đơn</option>
                                        <option value="1">Sửa</option>
                                        <option value="2">Xóa</option>
                                    </select>
                                </div>
                                <button class="btn  btn-info do-action">Thực hiện</button>
                                <button class="btn btn-success add-new">Thêm mới</button>
                            </div>
                        </div>

                    </div>
                </div>
                <!-- END Dynamic Table Full -->

            </div>
            <!-- END Page Content -->
        </main>
        <!-- END Main Container -->
        <!-- Footer -->
        <div w3-include-html="views/_includes/_footer.html"></div>
        <!-- END Footer -->
    </div>
    <!-- END Page Container -->
    <!-- Apps Modal -->
    <!-- Opens from the button in the header -->
    <div class="modal fade" id="apps-modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-sm modal-dialog modal-dialog-top">
            <div class="modal-content">
                <!-- Apps Block -->
                <div class="block block-themed block-transparent">
                    <div class="block-header bg-primary-dark">
                        <ul class="block-options">
                            <li>
                                <button data-dismiss="modal" type="button"><i class="si si-close"></i></button>
                            </li>
                        </ul>
                        <h3 class="block-title">Apps</h3>
                    </div>
                    <div class="block-content">
                        <div class="row text-center">
                            <div class="col-xs-6">
                                <a class="block block-rounded" href="index.html">
                                    <div class="block-content text-white bg-default">
                                        <i class="si si-speedometer fa-2x"></i>
                                        <div class="font-w600 push-15-t push-15">Backend</div>
                                    </div>
                                </a>
                            </div>
                            <div class="col-xs-6">
                                <a class="block block-rounded" href="frontend_home.html">
                                    <div class="block-content text-white bg-modern">
                                        <i class="si si-rocket fa-2x"></i>
                                        <div class="font-w600 push-15-t push-15">Frontend</div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END Apps Block -->
            </div>
        </div>
    </div>
    <!-- END Apps Modal -->
    <!--Core js-->

    <script src="assets/js/core/jquery.min.js"></script>
    <script src="assets/js/core/bootstrap.min.js"></script>
    <script src="assets/js/core/jquery.slimscroll.min.js"></script>
    <script src="assets/js/core/jquery.scrollLock.min.js"></script>
    <script src="assets/js/core/jquery.appear.min.js"></script>
    <script src="assets/js/core/jquery.countTo.min.js"></script>
    <script src="assets/js/core/jquery.placeholder.min.js"></script>
    <script src="assets/js/core/js.cookie.min.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="assets/js/plugins/sweetalert/sweetalert.min.js"></script>
    <!--end core js-->
    <!--datatable js-->

    <script src="assets/js/plugins/datatables/DataTables-1.10.12/js/jquery.dataTables.js"></script>

    <script src="assets/js/plugins/datatables/DataTables-1.10.12/js/dataTables.bootstrap.js"></script>
    <script src="assets/js/plugins/editor-1.5.6/js/dataTables.editor.js"></script>

    <script src="assets/js/plugins/editor-1.5.6/js/editor.bootstrap.js"></script>

    <script src="assets/js/plugins/datatables/Buttons-1.2.1/js/dataTables.buttons.js"></script>
    <script src="assets/js/plugins/datatables/Select-1.2.0/js/dataTables.select.js"></script>

    <script src="assets/js/plugins/select2/select2.full.min.js"></script>

    <script src="assets/js/siten-datatable.js"></script>
    <!--end datatable js-->
    <!-- Page JS Code -->
    <script>
        $(function () {
            w3IncludeHTML();

          

            var config =
             {
                 tableContainer: "#danh-sach-sp",
                 editorConfig: {
                     ajax: "/jsons/sample-product-list.json",
                     table: "#danh-sach-sp table",
                     idSrc: 'maSp',
                     fields: [
                         {
                             label: "Mã sản phẩm",
                             name: "maSp"
                         }, {
                             label: "Tên sản phẩm",
                             name: "tenSanPham"
                         }, {
                             label: "Danh mục",
                             name: "danhMuc",
                             type: "select",
                             options: (function () {
                                 return ["TP tươi sống", "Gia vị", "TP chế biến", "Đồ uống", "Đồ ăn vặt", "Dụng cụ nhà bếp"];
                             })()
                         }, {
                             label: "Hiển thị",
                             name: "hienThi",
                             type: "select",
                             options: ["Hiển thị", "Ẩn"]
                         }, {
                             label: "Trạng thái",
                             name: "trangThai",
                             type: "select",
                             options: ["Còn hàng", "Hết hàng"]
                         }, {
                             label: "Số lượng",
                             name: "soLuong"
                         }, {
                             label: "Đơn vị",
                             name: "donVi"
                         },
                         {
                             label: "Giá bán",
                             name: "giaBan"
                         }
                     ]
                 },

                 datatableConfig: {
                     dom: "frtlip",
                     serverSide: true,
                     "processing": true,
                     "ajax": function (data, callback, settings) {
                         var filter = {};
                         $(config.tableContainer).find(".filter-region").find("select,input").each(function (index, item) {
                             filter[$(item).attr('name')] = $(item).val();
                         });

                         var query = {
                             start: settings._iDisplayStart,
                             pageSize: settings._iDisplayLength,
                             draw: settings.iDraw,
                             filter: JSON.stringify(filter)
                         };

                         var sort = settings.aaSorting[0];
                         var column = settings.aoColumns[sort[0]];
                         if (column.data != null) {
                             query.sortBy = column.data;
                             query.order = sort[1];
                         }

                         $.ajax({
                             type: "GET",
                             dataType: 'json',
                             data: query,
                             url: "http://mamifood.dev/api/products",
                             crossDomain: true
                         })
                         .done(function (data) {

                             callback(data);
                         }.bind(this))
                         .fail(function (xhr, textStatus, errorThrown) {
                             alert(xhr.responseText);
                             alert(textStatus);
                         });

                     },
                     lengthMenu: [[5, 10, 25, 50], [5, 10, 25, 50]],
                     language: {
                         "url": "/assets/js/plugins/datatables/Languages/vietnamese.json"
                     },
                     columns: [
                         {
                             data: null,
                             defaultContent: '',
                             className: 'select-checkbox',
                             orderable: true
                         },
                         { data: "maSp" },
                         { data: "tenSanPham" },
                         { data: "danhMuc" },
                         {
                             data: "hienThi",
                             render: function (data, type, full, meta) {

                                 return '<input disabled type="checkbox"' + ((data) ? 'checked' : '') + '>';
                             }
                         },
                         { data: "trangThai" },
                         { data: "soLuong" },
                         { data: "donVi" },
                         { data: "giaBan" },
                         {
                             data: null, defaultContent: 'chi tiết'
                             //    render: function (data, type, full, meta) {

                             //        return getDetailTable();
                             //        //return '<div class="btn "><span class="si si-plus"></span></div>';
                             //    }
                         }
                     ]
                         ,
                     select: {
                         style: 'multi',
                         selector: 'td:first-child'
                     }
                 },

                 actions: {
                     edit: {
                         title: 'Cập nhật thông tin sản phẩm',
                         method: function (table) {
                             var selected = table.rows({ selected: true });
                             var selectedItems = selected.data();
                             if (selectedItems.length > 0) {

                                 table.row(selected.nodes()[0]).edit({ title: 'Cập nhật thông tin sản phẩm' });
                             }
                             else {

                             }
                         }
                     },
                     remove: {
                         confirmText: 'Bạn có chắc chắn muốn xóa sản phẩm này?',
                         title: '',

                         url: '',
                         method: function (table) {
                             var selectedItems = table.rows({ selected: true }).data();

                             var ids = [];
                             for (var i = 0; i < selectedItems.length; i++) {

                                 ids.push(selectedItems[i].id);
                             }

                             $.ajax({
                                 url: "http://mamifood.dev/products/delete",
                                 type: "GET",
                                 dataType: 'json',
                                 data: { ids: ids.join(',') },
                                 crossDomain: true,
                                 success: function (resp) {
                                     swal("Đã xóa!", "Sản phẩm đã xóa thành công", "success");
                                     table.rows(table.rows({ selected: true }).nodes()).remove().draw();
                                 }.bind(this),
                                 error: function (resp) {
                                     swal("Lỗi!", "Có lỗi xảy ra", "error");
                                 }
                             });
                         }

                     },
                     create: {
                         url: '',
                         title: '',
                         method: function (table) {
                             table.row.create();
                         }
                     }
                 }
             };
           
            var table = BaseTableDatatables(
                    config
            );

            window.setTimeout(function () {
                table.init();
            }.bind(this), 1000);


            //$.getJSON("/assets/js/configs/danh-sach-sp-config.json", function (config) {
            //    var table = BaseTableDatatables(
            //        config
            //    );

            //    window.setTimeout(function () {
            //        table.init();
            //    }.bind(this), 1000);
            //});
            
            
            // Init page helpers (BS Datepicker + BS Colorpicker + Select2 + Masked Input + Tags Inputs plugins)
            //App.initHelpers(['select2']);
        });
    </script>
</body>
</html>